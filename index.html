<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Маникюр • Василики</title>
  <meta name="description" content="Запись на маникюр к Василики — идеальный маникюр в Москве">

  <!-- Open Graph -->
  <meta property="og:title" content="Василики — идеальный маникюр в Москве">
  <meta property="og:description" content="Запишитесь онлайн за 30 секунд • Стерильность 100% • Более 5 лет опыта">
  <meta property="og:image" content="https://ваш-домен.рф/calendar/preview.jpg">
  <meta property="og:url" content="https://ваш-домен.рф">
  <meta property="og:type" content="website">

  <link rel="stylesheet" href="styles.css" media="print" onload="this.media='all'">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- PWA + Favicon -->
  <link rel="manifest" href="/calendar/manifest.json">
  <link rel="apple-touch-icon" href="/calendar/icon-192.png">
  <link rel="icon" href="/calendar/favicon.ico" sizes="any">
  <meta name="theme-color" content="#ff6b9d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- FingerprintJS — решает проблему "своих записей" в инкогнито -->
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>

  <!-- 2GIS Map API (бесплатно, без ключей) -->
  <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>

  <style>
    :root { --primary: #ff6b9d; --shadow: rgba(255,107,157,0.15); }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

    /* Скелетоны с шиммером */
    .skeleton {
      background: #ffffff;
      border-radius: 28px;
      box-shadow: 0 15px 40px var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .skeleton::before {
      content: '';
      position: absolute;
      top: 0; left: -150%;
      width: 50%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: shimmer 2s infinite;
    }
    @keyframes shimmer { 0% { left: -150%; } 100% { left: 100%; } }

    /* Анимация карточек */
    .service-card {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s ease-out;
    }
    .service-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* === НОВАЯ КАРТА 2GIS === */
    .map-section {
      padding: 100px 20px;
      background: #fff;
      text-align: center;
    }
    .map-section h2 {
      font-family: 'Playfair Display', serif;
      font-size: 2.8rem;
      color: var(--primary);
      margin-bottom: 50px;
    }
    #dgis-map {
      width: 100%;
      height: 500px;
      border-radius: 28px;
      box-shadow: 0 20px 50px var(--shadow);
      overflow: hidden;
      max-width: 1000px;
      margin: 0 auto;
    }
    @media (max-width: 768px) {
      #dgis-map { height: 400px; }
      .map-section h2 { font-size: 2.2rem; }
    }
  </style>
</head>
<body>

  <header class="hero">
    <div class="container">
      <h1>Василики</h1>
      <p class="subtitle">Идеальный маникюр — это искусство</p>
      <div class="buttons">
        <button class="btn primary" id="goToCalendar">Записаться онлайн</button>
        <button class="btn secondary" id="adminLogin">Войти как мастер</button>
      </div>
    </div>
  </header>

<section class="about">
  <div class="container">
    <h2>Почему выбирают меня</h2>
    <div class="features">
      <div>
        <div class="icon">Shield</div>
        <h3>Стерильность 100%</h3>
        <p>Одноразовые инструменты и крафт-пакеты</p>
      </div>
      <div>
        <div class="icon">Sparkles</div>
        <h3>Только премиум материалы</h3>
        <p>Luxe, Kodi, Luna — всё оригинал</p>
      </div>
      <div>
        <div class="icon">Trophy</div>
        <h3>Более 5 лет опыта</h3>
        <p>Тысячи довольных клиенток</p>
      </div>
      <div>
        <div class="icon">Heart</div>
        <h3>Индивидуальный подход</h3>
        <p>Подберу дизайн именно под тебя</p>
      </div>
    </div>
  </div>
</section>

  <!-- УСЛУГИ -->
  <section id="services-section" style="padding:80px 20px;background:linear-gradient(135deg,#fff5f9,#fdf8fb);text-align:center">
    <div class="container">
      <h2 style="font-size:2.8rem;color:var(--primary);margin-bottom:60px;font-weight:800">Услуги и цены</h2>
      <div id="services-list" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:30px;justify-items:center">
        <div class="skeleton" style="padding:40px;height:380px">
          <div style="height:32px;background:#e9ecef;border-radius:12px;width:80%;margin:20px auto"></div>
          <div style="height:60px;background:#e9ecef;border-radius:16px;width:60%;margin:30px auto"></div>
          <div style="height:20px;background:#e9ecef;border-radius:10px;width:70%;margin:20px auto"></div>
        </div>
        <div class="skeleton" style="padding:40px;height:380px;opacity:0.7"></div>
        <div class="skeleton" style="padding:40px;height:380px;opacity:0.5"></div>
      </div>
    </div>
  </section>

  <!-- НОВАЯ КАРТА 2GIS -->
  <section class="map-section">
    <div class="container">
      <h2>Где я работаю</h2>
      <div id="dgis-map"></div>
    </div>
  </section>

  <!-- ГАЛЕРЕЯ -->
  <section class="gallery">
    <div class="container">
      <h2>Мои работы</h2>
      <div class="grid">
        <img src="./assets/photo1.jpg" alt="Красивый маникюр" loading="lazy">
        <img src="./assets/photo2.jpg" alt="Дизайн ногтей" loading="lazy">
        <img src="./assets/photo3.jpg" alt="Педикюр" loading="lazy">
        <img src="./assets/photo4.jpg" alt="Комби маникюр" loading="lazy">
        <img src="./assets/photo5.jpg" alt="Гель-лак" loading="lazy">
        <img src="./assets/photo6.jpg" alt="Френч" loading="lazy">
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>Москва • Работаю по записи</p>
      <p>Instagram: <a href="https://instagram.com/your_nick" target="_blank" rel="noopener">@your_nick</a></p>
    </div>
  </footer>

  <div id="modal-root" aria-hidden="true"></div>

  <!-- Firebase + Auth -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCr08aVXswvpjwwLvtSbpBnPhE8dv3HWdM",
      authDomain: "calendar-666-5744f.firebaseapp.com",
      projectId: "calendar-666-5744f",
      appId: "1:665606748855:web:5e4a2865b1f26494cf2b32"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    window.firebaseDb = db;

    document.getElementById("goToCalendar").onclick = () => location.href = "calendar.html";

    document.getElementById("adminLogin").onclick = () => {
      if (auth.currentUser) { signOut(auth); return; }
      document.getElementById("modal-root").innerHTML = `
        <div style="position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999">
          <div style="background:white;padding:30px;border-radius:20px;width:90%;max-width:400px">
            <h3 style="margin:0 0 20px;color:#ff6b9d">Вход для мастера</h3>
            <input type="email" id="loginEmail" placeholder="admin@example.com" style="width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:12px">
            <input type="password" id="loginPass" placeholder="пароль" style="width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:12px">
            <div style="display:flex;gap:10px;margin-top:20px">
              <button onclick="document.getElementById('modal-root').innerHTML=''" style="flex:1;padding:12px;background:#ccc;border:none;border-radius:12px">Отмена</button>
              <button onclick="loginMaster()" style="flex:1;padding:12px;background:#ff6b9d;color:white;border:none;border-radius:12px">Войти</button>
            </div>
          </div>
        </div>`;
    };

    window.loginMaster = async () => {
      const email = document.getElementById("loginEmail")?.value.trim();
      const pass = document.getElementById("loginPass")?.value;
      if (!email || !pass) return alert("Заполните все поля");
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        document.getElementById("modal-root").innerHTML = "";
        setTimeout(() => location.href = "calendar.html", 500);
      } catch (e) {
        alert("Неверный логин или пароль");
      }
    };

    onAuthStateChanged(auth, user => {
      document.getElementById("adminLogin").textContent = user ? "Выйти" : "Войти как мастер";
    });
  </script>

  <!-- УСЛУГИ + КЭШ + FINGERPRINTJS -->
  <script type="module">
    import { collection, getDocs, query } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const servicesList = document.getElementById("services-list");

    // === FINGERPRINTJS ===
    let clientId = localStorage.getItem('clientId');
    if (!clientId) {
      FingerprintJS.load().then(fp => {
        fp.get().then(result => {
          clientId = result.visitorId;
          localStorage.setItem('clientId', clientId);
        });
      });
    }

    // === РЕНДЕР УСЛУГ ===
    const renderServices = (services) => {
      if (services.length === 0) {
        servicesList.innerHTML = `<div style="grid-column:1/-1;padding:60px;background:#fff;border-radius:28px"><p style="color:#ff6b9d;font-size:1.6rem;font-weight:600">Услуги ещё не добавлены</p></div>`;
        return;
      }

      servicesList.innerHTML = services.map(s => `
        <div class="service-card" style="background:#fff;padding:40px;border-radius:28px;box-shadow:0 15px 40px var(--shadow);transition:all .5s">
          <h3 style="font-size:1.8rem;color:#333;margin:0 0 16px">${s.name}</h3>
          <div style="font-size:3rem;font-weight:900;color:var(--primary);margin:20px 0">${s.price}₽</div>
          <p style="color:#666;font-size:1.2rem;margin-bottom:20px">Продолжительность: <strong>${s.duration} мин</strong></p>
          <button onclick="location.href='calendar.html?service=${s.id}'"
                  style="background:var(--primary);color:white;padding:16px 36px;border:none;border-radius:50px;font-weight:700;cursor:pointer;transition:all .3s;box-shadow:0 8px 20px var(--shadow)"
                  onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 15px 30px rgba(255,107,157,.4)'"
                  onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 8px 20px var(--shadow)'">
            Записаться
          </button>
        </div>
      `).join("");

      requestAnimationFrame(() => {
        document.querySelectorAll(".service-card").forEach((card, i) => {
          setTimeout(() => card.classList.add("visible"), i * 150);
        });
      });
    };

    const loadServices = async () => {
      const cached = localStorage.getItem("services_cache_v2");
      if (cached) {
        const { data, time } = JSON.parse(cached);
        if (Date.now() - time < 600000) renderServices(data);
      }

      try {
        const snapshot = await getDocs(query(collection(window.firebaseDb, "services")));
        const services = snapshot.docs
          .map(d => ({ id: d.id, ...d.data() }))
          .filter(s => s.name && s.price && s.duration)
          .sort((a, b) => a.price - b.price);

        renderServices(services);
        localStorage.setItem("services_cache_v2", JSON.stringify({ data: services, time: Date.now() }));
      } catch (err) {
        console.error(err);
        servicesList.innerHTML = `<div style="grid-column:1/-1;color:#e74c3c;padding:40px;background:#fff;border-radius:28px">Ошибка загрузки услуг</div>`;
      }
    };

    if (window.firebaseDb) loadServices();
    else setInterval(() => window.firebaseDb && (clearInterval(this), loadServices()), 100);
  </script>

  <!-- ИНИЦИАЛИЗАЦИЯ КАРТЫ 2GIS -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      if (typeof DG === "undefined") {
        console.warn("2GIS API не загрузился");
        return;
      }

      DG.then(function () {
        const map = DG.map('dgis-map', {
          center: [55.7558, 37.6173],  // Замени на координаты твоего салона!
          zoom: 16
        });

        DG.marker([55.7558, 37.6173], {
          icon: DG.icon({
            iconUrl: 'data:image/svg+xml;utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><circle cx="20" cy="20" r="16" fill="%23ff6b9d" stroke="white" stroke-width="4"/><circle cx="20" cy="20" r="8" fill="white"/></svg>',
            iconSize: [40, 40],
            iconAnchor: [20, 40]
          })
        }).addTo(map)
          .bindPopup('<b style="color:#ff6b9d">Салон Василики</b><br>Москва<br><a href="tel:+79001234567">+7 (900) 123-45-67</a>')
          .openPopup();
      });
    });
  </script>

</body>
</html>